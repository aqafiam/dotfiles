#!/bin/zsh

git_branch=$(git status | awk 'NR==1 {print $3}')

if g_status=$(cd $1 && git status -s 2>/dev/null); then

  if [ $(echo $g_status | grep -c -E '^( M|MM) ') > 0 ]; then
    state="#[bg=yellow,fg=black] * #[fg=default]" ;
  elif [ $(echo $g_status | grep -c -E "^M  ") > 0 ]; then
    state="#[bg=colour013,fg=black] + #[default]" ;
  elif [ $(echo $g_status | grep -c -E "^UU ") > 0 ]; then
    state="#[bg=red,fg=black] x #[fg=default]" ;
  else
    state="#[bg=green,fg=black] o #[default]" ;
  fi

  if [[ $git_branch != "master" ]]; then
    git_info="#[underscore]#[bg=black,fg=colour014] (${git_branch}) #[default]${state}"
  else
    git_info="#[underscore]#[bg=black,fg=blue] (master) #[default]${state}"
  fi
else
  git_info=""
fi

directory="#[underscore]#[bg=black,fg=cyan]$1#[default]"

echo "$directory$git_info"
